---
layout: post
title: Postman接口测试六 | pre-request-script
categories: [Postman]
description: some word here
keywords: keyword1, keyword2
---

Postman 提供pre-request-script功能用于修改request之前的请求参数。打开请求，在Request区域点击tab”pre-request-script“，当然postman也提供一些现成的示例片段，见右侧SNIPPETS 区域

### 示例介绍

1、Get an environment variable

```
pm.environment.get("variable_key");
```
//获得环境变量


2、Get a global variable

```
pm.globals.get("variable_key");
```
//获得全局环境变量

3、Get a variable

```
pm.variables.get("variable_key");
```
//获得一个变量

4、Set an environment variable

```
pm.environment.set("variable_key", "variable_value");

```
//设置环境变量

5、Clear an environment variable

```
pm.environment.unset("variable_key");
```
//清除环境变量

6、Clear a global variable

```
pm.globals.unset("variable_key");

```
//清除全局变量

7、Send a request

```
pm.sendRequest("https://postman-echo.com/get", function (err, response) {
console.log(response.json());
});
```
//发送一个请求

### 前提

1、Add一个environment：test, 并选择该环境变量

  ![](/images/2020-11-11-1.png)

  ![](/images/2020-11-11-2.png)

2、打开一个请求的 Request > pre-request-script 页签，填写代码

### 设置&清除环境变量

```
pm.environment.set("did", "95a77d236eab2cf3ea17ddc19450a2ca");
console.log(pm.environment.get("did"))
pm.environment.set("host", "http://api.anychat.boochat.cn");
console.log(pm.environment.get("host"))
```
// 设置环境变量did=95a77d236eab2cf3ea17ddc19450a2ca, host=http://api.anychat.boochat.cn 并输出日志


3、调用设置的环境变量{{host}},{{did}}
4、点击send，点击右上角的眼睛标志，可以看到环境变量已经设置，且依赖最新设置的环境变量，在Response区域返回了结果

  ![](/images/2020-11-11-3.png)

  备注：以上的token来自tests页签

  ![](/images/2020-11-11-4.png)

5、```pm.environment.unset("did");```点击send，在查看右上角发现，did使用完又被清除了

  ![](/images/2020-11-11-5.png)

### 发送请求

```
pm.sendRequest("https://postman-echo.com/get", function (err, response) {
console.log(response.json());
});
```

可利用的场景：某一类请求统一去服务器加密等，目前的项目没有这样的需求，以前的项目又这样的需求，但是不好举例了。

下面的例子是返回值是加密的，需要修改的是返回值的Tests（用法一样，所以写在此处）

  ![](/images/2020-11-11-6.png)

原做法：拷贝加密代码去一个接口里面进行解密
现做法：修改Tests，增加如下代码

```
var jsonData = pm.response.json()
const echoPostRequest = {
url: 'http://192.168.1.10:13001/v1/aes',
method: 'POST',
header:'Content-Type:application/json',
body: {
mode: 'raw',
raw: JSON.stringify({"t":"decode","data": jsonData.data})
}
};
pm.sendRequest(echoPostRequest, function (err, res) {
console.log(err ? err : res.json());
});
```
运行后，可以看到解密的数据展示在了console中（要是能直接展示在Response区域就更好了）

  ![](/images/2020-11-11-7.png)

### 批量pre-request-script

同批量执行Tests的方法一样，见上文


